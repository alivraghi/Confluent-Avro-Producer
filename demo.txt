# Start Confluent DEV environment
confluent start

# Start ElasticSearch
elasticsearch --daemonize --pidfile=/tmp/.elasticsearch.pid

	# zookeeper:2181
	# kafka:9092
	# schema-registry:8081
	# kafka-rest:8082
	# connect:8083
	# ksql:
	# control-center:
	# elasticsearch:9200+9300

# Retreive Elasticsearch indexes
curl -X GET "localhost:9200/_cat/indices?v"

# Load elasticsearch-sink Kafka Connector
confluent load kafka_perl_test-elasticsearch-sink -d ~/Confluent-Avro-Producer/resource/kafka_perl_test-elasticsearch-sink.properties 
# Load jdbc-sink Kafka Connector
confluent load kafka_perl_test-jdbc-sink -d ~/Confluent-Avro-Producer/resource/kafka_perl_test-sink.properties 


# List Schema Registry subjects
curl -X GET http://localhost:8081/subjects | json_pp

# Start Kafka Avro console PRODUCER
kafka-avro-console-producer  --broker-list localhost:9092 --topic kafka_perl_test  --property value.schema='{"type":"record","name":"myrecord","fields":[{"name":"id","type":"int"},{"name":"product", "type": "string"}, {"name":"quantity", "type": "int"}, {"name":"price","type": "float"}]}'

{"id": 0, "product": "foo", "quantity": 100, "price": 250.65}
{"id": 1, "product": "bar", "quantity":  50, "price": 0.25}
{"id": 2, "product": "pir", "quantity": 299, "price": 50.00}

# List subject versions
curl -X GET http://localhost:8081/subjects/kafka_perl_test-value/versions | json_pp

# Start Kafka Avro console CONSUMER
kafka-avro-console-consumer --bootstrap-server=localhost:9092 --from-beginning --topic kafka_perl_test

# Read from Elasticsearch index
curl -X GET "localhost:9200/kafka_perl_test/_search?pretty"


# # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # # #


# Delete subject from Schema Registry
curl -X DELETE http://localhost:8081/subjects/kafka_perl_test-value | json_pp

# Delete Elasticsearch index
curl -X DELETE "localhost:9200/kafka_perl_test?pretty"

# Drop oracle table
oracle_query remote_activity/remote_activity@artbase "drop table kafka;"

# Kafka topics data directory (if needed)
cd $(cat /tmp/confluent.current)/kafka/data/

# Delete topic 
kafka-topics --zookeeper localhost:2181 --delete --topic kafka_perl_test

# Unload Connectors
confluent unload kafka_perl_test-jdbc-sink 
confluent unload kafka_perl_test-elasticsearch-sink

# Delete topic
kafka-topics --zookeeper localhost:2181 --delete --topic kafka_perl_test

# Stop Confluent DEV environment
confluent stop

# Stop Elasticsearch
kill $(cat /tmp/.elasticsearch.pid)

